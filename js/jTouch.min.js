/* 
	jTouch v1.0  2013-05-20
	https://github.com/liutian1937/jTouch
	ok8008@yeah.net
*/
(function(){var f=0,i,h,j='';var k=function(c,b,a){this.evt=c;this.touch=b;this.startX=this.currentX=b.screenX;this.startY=this.currentY=b.screenY;this.eventType=null;this.startTime=new Date();this.checkLongTap(a)};k.prototype={getTapType:function(){var c=this;f=(f==0)?1:f+1;if(f==1){c.eventType='tap'}else if(f==2){c.eventType='doubletap';clearTimeout(i)}else{f=0}},checkLongTap:function(c){var b=this;clearTimeout(h);h=setTimeout(function(){b.eventType='longtap';b.touchCallback(c)},500)},move:function(c,b){var a=this;clearTimeout(h);a.currentX=c.screenX;a.currentY=c.screenY;var d=a.currentX-a.startX;var e=a.currentY-a.startY;if(a.eventType=='longtap'||a.eventType=='hold'){a.eventType='hold'}else{a.eventType='swipe'}var g={};if(Math.abs(d)>Math.abs(e)||j=='LeftRight'){g['direction']=d>0?'right':'left';j='LeftRight'}else{g['direction']=e>0?'down':'up'}g['x']=d;g['y']=e;a.touchCallback(b,g)},process:function(c){var b=this;var a=b.currentX-b.startX;var d=b.currentY-b.startY;if(b.eventType&&b.eventType!=='swipe'&&b.eventType!=='hold'){return false};clearTimeout(h);if(a==0&&d==0){b.getTapType();if(f==1){i=setTimeout(function(){b.touchCallback(c)},250)}else if(f==2){b.touchCallback(c)}}else if(Math.abs(d)>0||Math.abs(a)>0){var e={};e['x']=a;e['y']=d;if(new Date()-b.startTime<=200){if(Math.abs(d)>Math.abs(a)){e['direction']=d>0?'down':'up'}else{e['direction']=a>0?'right':'left'}b.eventType='flip'}else{e['status']='end'}b.touchCallback(c,e)}},touchCallback:function(c,b){var a=this;var b=b||{};b['fingerNum']=a.evt.changedTouches.length;var d=a.evt.changedTouches.length;if(a.touch.identifier==a.evt.changedTouches[d-1].identifier){if(c.typeFn[a.eventType])c.typeFn[a.eventType](a.evt,b);f=0}}};var l=function(c,b){this.data={};this.eventType=null;this.rotateActive=this.pinchActive=false};l.prototype={change:function(c,b){var a=this;if(b.objEvent.touches.length==2){if(!a.startData){a.startData=a.getData(b)}a.currentData=a.getData(b);var d=a.getAngle(a.startData)-a.getAngle(a.currentData);var e=a.getDistance(a.startData)-a.getDistance(a.currentData);console.log(Math.abs(e));if(Math.abs(d)>10||a.rotateActive){a.eventType='rotate';a.data['direction']=(c.rotation<0)?'left':'right';a.data['rotation']=c.rotation;a.gestureCallback(c,b,a.data);a.rotateActive=true};if(Math.abs(e)>10||a.pinchActive){a.eventType='pinch';a.data['type']=(c.scale<1)?'in':'out';a.data['scale']=c.scale;a.gestureCallback(c,b,a.data);a.pinchActive=true}}},end:function(c,b){var a=this;a.data['rotation']=c.rotation;a.data['scale']=c.scale;a.data['status']='end';a.gestureCallback(c,b,a.data)},gestureCallback:function(c,b,a){var d=this;if(b.typeFn[d.eventType])b.typeFn[d.eventType](c,a)},getData:function(c){var b=this;var a=c.objEvent.touches;var d=new Array();for(var e=0;e<a.length;e++){d.push({x:a[e].pageX,y:a[e].pageY})};return d},getAngle:function(c){var b=c[0];var a=c[1];var d=Math.atan((a.y-b.y)*-1/(a.x-b.x))*(180/Math.PI);if(d<0){return d+180}else{return d}},getDistance:function(c){var b=c[0];var a=c[1];return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))*-1}};var m=function(b){var a=this;a.obj=b||window;a.touches={};a.typeFn={};a.gesture=null;a.obj.addEventListener('touchstart',function(c){a.touchStart(c)},false);a.obj.addEventListener('touchmove',function(c){a.touchMove(c)},false);a.obj.addEventListener('touchend',function(c){a.touchEnd(c)},false);a.obj.addEventListener('touchcancel',function(c){a.touchCancel(c)},false);a.obj.addEventListener('gesturestart',function(c){a.gestureStart(c)},false);a.obj.addEventListener('gesturechange',function(c){a.gestureChange(c)},false);a.obj.addEventListener('gestureend',function(c){a.gestureEnd(c)},false)};m.prototype={on:function(c,b){this.typeFn[c]=b;return this},touchStart:function(b){b.preventDefault();var a=this;a.touches={};a.objEvent=b;a.touchLoop(b,function(c){a.touches[c.identifier]=new k(b,c,a)});if(a.typeFn['start']){a.typeFn['start'](b)}},touchMove:function(a){a.preventDefault();var d=this;d.objEvent=a;d.touchLoop(a,function(c){var b=d.touches[c.identifier];if(b){b.move(c,d)}})},touchEnd:function(b){b.preventDefault();var a=this;a.touchLoop(b,function(c){a.touchClear(c,false)});if(a.typeFn['end']){a.typeFn['end'](b)}},touchCancel:function(b){b.preventDefault();var a=this;a.touchLoop(b,function(c){a.touchClear(c,true)})},touchLoop:function(c,b){var a=c.changedTouches.length;b(c.changedTouches[a-1])},touchClear:function(c,b){var a=this;if(!b){var d=a.touches[c.identifier];if(d){d.process(a)}};delete a.touches[c.identifier]},gestureStart:function(c){c.preventDefault();var b=this;b.gesture=new l(c,b)},gestureChange:function(c){c.preventDefault();var b=this;b.gesture.change(c,b)},gestureEnd:function(c){var b=this;b.gesture.end(c,b);b.gesture=null}};window.jTouch=m}());