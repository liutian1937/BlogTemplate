<!DOCTYPE html>
<html lang="zh-CN">
<head profile="http://gmpg.org/xfn/11">
<meta charset="UTF-8">
<title>Blog</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2, minimum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/icon.css" />
<script type="text/javascript" src="js/Common.js"></script>
<script type="text/javascript" src="js/JTouch.js"></script>
<script type="text/javascript" src="js/JScroll.js"></script>
<script type="text/javascript" src="js/JNav.js"></script>
</head>
<body>
	
		<nav id="nav">
		
			<div class="abs top20 icons iconShadow">
				<span class="icon" data-icon="&#x0055;"></span>
				<a href="#">返回上一级</a>
			</div>
			
			<div class="abs top90">
				<div class="icons iconShadow cur">
					<span class="icon" data-icon="&#xe11c;"></span>
					<a href="#">按分类分组</a>
				</div>
				
				<div class="icons iconShadow">
					<span class="icon" data-icon="&#xe13a;"></span>
					<a href="#">按时间分组</a>
				</div>
				
				<div class="icons iconShadow">
					<span class="icon" data-icon="&#x003b;"></span>
					<a href="#">按标签分组</a>
				</div>
				
				
			</div>
			
			<div class="abs centerIcon">
				<div class="icons iconShadow" data="prev">
					<span class="icon" data-icon="&#xe042;"></span>
					<a href="#">上一页</a>
				</div>
				
				<div class="icons iconShadow" data="next">
					<span class="icon" data-icon="&#xe044;"></span>
					<a href="#">下一页</a>
				</div>
			</div>
			
			<div class="abs bottom90">
				
				<div class="icons iconShadow">
					<span class="icon" data-icon="&#xe10b;"></span>
					<a href="#">按阅读排序</a>
				</div>
				<div class="icons iconShadow">
					<span class="icon" data-icon="&#xe02b;"></span>
					<a href="#">按好评排序</a>
				</div>
				
			</div>
			
			<div class="abs bottom0">
				
				<div class="icons iconShadow">
					<span class="icon" data-icon="&#xe135;"></span>
					<a href="#">RSS订阅</a>
				</div>
			</div>
			
		</nav>
		<div id="content" class="clear">
			<!--content left start-->
			<div id="contentLeft">
								
				<div id="itemWrap">
					<!--item list start-->
					
					<ul class="item">
						<li class="cateName">
							<a href="#" class="yahei"><span>牛魔王的世界观</span></a>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0a5;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0a5;"></span>
							</div>
						</li>
					</ul>
					<ul class="item">
						<li class="cateName">
							<a href="#" class="yahei"><span>Web前端开发</span></a>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0a9;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0a9;"></span>
							</div>
						</li>
					</ul>
					<ul class="item">
						<li class="cateName">
							<a href="#" class="yahei"><span>Web Front-End Developer</span></a>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0cb;"></span>
							</div>
						</li>
					</ul>
					<ul class="item">
						<li class="cateName">
							<a href="#" class="yahei"><span>前端攻城师</span></a>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0b4;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0b4;"></span>
							</div>
						</li>
						<li star-icon="&#xe02b;"  circle-icon="&#xe10b;" data="">
							<div>
								<time pubdate="pubdate">2013年4月8号星期三</time>
								<a href="http://baidu.com" class="title">Javascript触屏手势库-JTouch</a>
								<p>JTouch是针对触屏浏览器提供的一个手势集合。支持现代浏览器以及触屏设置，尚未完成ie10的兼容</p>
								<span class="icon" data-icon="&#xe0b4;"></span>
							</div>
						</li>
					</ul>
					
					<!--item list end-->
				</div>
				
			</div>
			<!--content left end-->
			<!--content right start-->
			<div id="contentRight">
				
				<!--content top start-->
				<div id="contentTop" class="box">
					
					<a href="javascript:;" title="字号--" onclick="Common.fontSize('minus');">
						<span class="icon" data-icon="&#xe12d;"></span>
					</a>
					<a href="javascript:;" title="字号++" onclick="Common.fontSize('plus');">
						<span class="icon" data-icon="&#xe12c;"></span>
					</a>
					
					<div class="rightIcon clear">
						<a href="javascript:;">
							<span class="icon" data-icon="&#xe02b;"></span>
						</a>
						<a href="javascript:;">
							<span class="icon" data-icon="&#xe10b;"></span>
						</a>
						<a href="javascript:;">
							<span class="icon" data-icon="&#xe15b;"></span>
						</a>
					</div>
					
				</div>
				
				<div id="dropShadow" class="dropShadow" style="opacity:0;"></div>
				
				<!--content top end-->
				<!--content wrap start-->
					<div id="contentWrap">
						
						<div id="postWrap">
							
							<a href="json/3.json" class="siblink" id="prevArticle">
								<span class="icon" data-icon="&#xe04b;"></span>
								<h3>Repository Next</h3>
								<span class="category">June 17, 2013</span>
							</a>
							<article>
								<header class="header">
									<time pubdate="pubdate">June 9, 2013</time>
									<h1 class="yahei">Javascript触屏手势库-JTouch(更新V1.1)</h1>
								</header>
								<section class="content">
									
									<p><img class="size-full wp-image-1224" title="boat-anchor-text-links" alt="Javascript触屏手势库-jTouch" src="http://liutian1937.github.io/JTouch/images/jtouch.jpg" width="450" height="450"></p><p class="wp-caption-text">Javascript触屏手势库-jTouch</p> <p>触屏手势库--JTouch</p><p>封装的代码有不足支出，以及bug等欢迎大家多多指正。</p><p>Github地址：<a href="https://github.com/liutian1937/JTouch" target="_blank">https://github.com/liutian1937/JTouch</a>&nbsp;（大家可以fork项目跟踪最新进展）</p><h2>JTouch的介绍</h2><p>JTouch是针对触屏浏览器提供的一个手势集合，由于我的测试环境主要是ipad，所以对于其他触屏设备的支持情况可能会有所不足。这个在后期版本升级过程中会修复。</p><p>JTouch在手指移动上去会触发<strong>start</strong>事件，结束会触发<strong>end</strong>事件。主要支持的手势有tap(单击)，doubletap(双击)，longtap（长按），hold（拖拽），swipe（滑动），flick（轻拂），pinch（捏合，拉伸），rotate（旋转）；除了pinch，rotate手势外，其他手势事件的回调函数都会返回<span style="color: #db4f33;"><strong>data["fingerNum"]</strong><span style="color: #000000;">值，所以在回调函数中可以根据手指的数量来拼合其他的事件。</span></span></p> <p>其中每个手势事件都会返回响应的回调函数，接受回调函数的参数值一般定义为evt和data，可自行设定。</p><ul><li>其中swipe和flip可以返回方向data["direction"]以及左右，上下移动的距离data["x"]，data["y"]，swipe事件结束会返回状态值data["status"] == &nbsp;end；</li> <li>pinch会返回type信息，即in和out，来判断向里还是向外压缩或者拉伸;返回data["scale"]表示缩放比例；</li> <li>rotate同样会有direction信息来简单判断向左旋转亦或向右旋转，同时返回data["rotation"]作为角度信息；</li> <li>每个手势事件都有相应的event对象返回，其中pinch和rotate返回的与其他的event对象是不同的，这两个返回的是gesturechange的事件对象，（详细信息可以在debug模式下调试查看）</li> </ul> <h2>jTouch的使用</h2> <ol> <li>实例化<br> var objTouch = document.getElementById("touch");<br> var Touches = JTouch(objTouch);</li> <li>采用链式写法，<br> <blockquote><p>Touches.on("手势名称",function(evt,data){<br> //回调函数部分<br> })</p> </blockquote> </li> <li>回调函数中返回相应的值</li> </ol> <h2>JTouch的示例</h2> <p><a href="http://liutian1937.github.io/JTouch/carousel.html" target="_blank">http://liutian1937.github.io/JTouch/carousel.html</a></p> <p>触摸平滑移动，其中用到了单独封装的translate插件，时间有限代码略显粗糙，各位看官见谅。</p> <p><a href="http://liutian1937.github.io/JTouch/touch.html" target="_blank">http://liutian1937.github.io/JTouch/touch.html</a></p> <p>稍微仿了下ipad的界面效果，有太多不足支持。长按可以触发icon抖动，双击空白取消效果，但是取消效果过程会产生抖动，希望哪位高人提点意见。其中想到了用-webkit-animation-play-state:paused;来实现，但是具体如何让动画停在第一帧不甚了解。</p> <p>另外做了个简单的图像效果，这个效果的flick效果还没有强化，关于这个效果我感觉我实现的复杂了一些，但是暂时没有想到万全之策，所以里面出现了不少的参数，哪位高人见到可以优化之。大家可以根据这个效果扩展成一个相册效果。具有左右翻的效果。</p> <hr> <p><strong>更新记录：</strong></p> <p><span style="color: #339966;">v1.1更新记录：</span></p><p>命名jTouch -&gt; JTouch 实例化不需要new，直接JTouch 加入鼠标手势操作，鼠标可以实现tap.doubletap,swipe,hold,flip操作，可以用mousewheel模拟pinch 加入init(),destory()功能来实现重置和销毁 <br/><span style="color: #ff6600;">不足：手头没有win8的平板，暂时没有实现ie10的触控手势</span></p>


								</section>
								<footer class="footer">
									
								</footer>
							</article>
							<a href="json/1.json" class="siblink" id="nextArticle">
								<span class="icon" data-icon="&#xe047;"></span>
								<h3>The Revolution Will Be Forked</h3>
								<span class="category">May 9, 2013</span>
							</a>
						</div>
						
					</div>
				<!--content wrap end-->
			</div>
			<!--content right end-->
		</div>

	
<script>

//左侧ICON图标部分
JTouch(Common.getId('nav')).on('start',function(evt){
	var target = evt.target.parentNode;
	if(Common.hasClass(target,'icons')){
		Common.addClass(target,'hover');
	}
}).on('end',function(evt){
	var target = evt.target.parentNode;
	if(Common.hasClass(target,'icons')){
		setTimeout(function(){
			Common.removeClass(target,'hover');
		},500);
	}
}).on('tap',function(evt){
	var target = evt.target.parentNode, fn;
	fn = target.getAttribute('data');
	Common[fn]();
});


var JN = JNav(Common.getId('itemWrap')); //实例化JNav

//中间标题列表
var JLeft = JScroll({
	'wrap' : Common.getId('itemWrap'),
	'stopEvent' : true,
	'horizontal' : function(evt,data) {
		var target = evt.target || evt.srcElement;
		target = Common.getParent(target,'li');
		
		if(target && target.className != 'cateName'){
			JLeft.target = target;
			if(Common.hasClass(target,'cur')){
				JLeft.targetCur = true;
				Common.removeClass(target,'cur');
			};
			if(data['x'] >= 70){
				var x = data['x'] - 70;
				Common.transform(target,x,0,0);
				Common.transform(target.getElementsByTagName('div')[0],70,0,0);
				if(x > 0){
					JLeft.act = 'like';
				};
			}else if(data['x'] <= -70){
				var x = data['x'] + 70;
				Common.transform(target,x,0,0);
				Common.transform(target.getElementsByTagName('div')[0],-70,0,0);
				if(x < 0){
					JLeft.act = 'read';
				};
			}else{
				Common.transform(target.getElementsByTagName('div')[0],data['x'],0,0);
				JLeft.act = '';
			};
			
			if(data['status'] == 'end'){
				Common.transform(target,0,0,100);
				Common.transform(target.getElementsByTagName('div')[0],0,0,100);
				JLeft.target = null;
				if(JLeft.targetCur){
					Common.addClass(target,'cur');
					JLeft.targetCur = false;
				};
				if(JLeft.act != ''){
					Article[JLeft.act]();
				}
			};
		};
					
	},
	'initFn' : function (obj) {
		JN.init();
		JN.scroll(-obj.disTop);
	},
	'tapFn' : function (id,target){
		Common.removeAllClass('cur');
		target.className = 'cur';
	},
	'moveFn' : function (obj) {
		JN.scroll(-obj.disTop);
	},
	'endFn' : function (obj) {
		JN.scroll(-obj.resultTop);
		if(obj.target){
			//水平拖拽的释放
			Common.transform(obj.target,0,0,100);
			Common.transform(obj.target.getElementsByTagName('div')[0],0,0,100);
			JLeft.target = null;
			if(obj.targetCur){
				Common.addClass(target,'cur');
				obj.targetCur = false;
			};
		};
	}
});

var Article = {
	'like' : function(){
		
	},
	'read' : function(){
	}
}

var JRight = JScroll({
	'wrap' : Common.getId('postWrap'),
	'minusHeight' : 55,
	'moveLimit' : 100,
	'childHeight' : 'article',
	'horizontal' : false,
	'showBar' : true,
	'moveFn' : function (obj) {
		//拖拽过程中的回调事件
		Common.css(Common.getId('dropShadow'),{
			'opacity' : 1
		});
	},
	'prevFn' : function (status){
		//拖拽到顶部的异步加载事件
		if(status === 'start'){
			Common.addClass(Common.getId('prevArticle'),'rotate');
		}else if(status === 'back'){
			Common.removeClass(Common.getId('prevArticle'),'rotate');
		}else if(status === 'end'){
			var href = Common.getId('prevArticle').getAttribute('href');
			if(href != ''){
				ajaxData(href);
			};
		}
	},
	'nextFn' : function (status){
		//拖拽到底部的异步加载事件
		if(status === 'start'){
			Common.addClass(Common.getId('nextArticle'),'rotate');
		}else if(status === 'back'){
			Common.removeClass(Common.getId('nextArticle'),'rotate');
		}else if(status === 'end'){
			var href = Common.getId('nextArticle').getAttribute('href');
			if(href != ''){
				ajaxData(href);
			};
		}
	},
	'endFn' : function (obj) {
		//拖拽一次结束后回调事件
		var num = (obj.resultTop === 0)?0:1;
		Common.css(Common.getId('dropShadow'),{
			'opacity' : num
		});
	}
});

//异步载入数据
function ajaxData(href){
		Ajax.request(href,{
				data : '',
				success : function(xhr){
					var json;
					json = xhr.responseText;
					json = JSON.parse(json);
					
					Common.getId('postWrap').getElementsByTagName('time')[0].innerHTML = json.time;
					Common.getId('postWrap').getElementsByTagName('h1')[0].innerHTML = json.title;
					Common.getId('postWrap').getElementsByTagName('section')[0].innerHTML = json.content;
					
					Common.getId('prevArticle').setAttribute('href',json.prev.url);
					Common.getId('nextArticle').setAttribute('href',json.next.url);
					Common.getId('prevArticle').getElementsByTagName('h3')[0].innerHTML = json.prev.title;
					Common.getId('nextArticle').getElementsByTagName('h3')[0].innerHTML = json.next.title;
					
					ImagesList(Common.getId('postWrap'));
					Common.fontSize('keep');//设置字体大小
				},
				failure : function(xhr){
					//载入失败
					console.log('error');
				}
			}
		);
};
function ImagesList(obj) {
	var i = 0, ImgList = obj.getElementsByTagName('img'), Img = [], imgsrc, len = ImgList.length, LoadNum = 0;
	for(i; i < len; i += 1){
		imgsrc = ImgList[i].getAttribute('src');
		ImgList[i].setAttribute('src','images/blank.gif');
		(function(j){
			Img[j] = AsyncImg().getUrl(imgsrc).callback(function(url){
				ImgList[j].setAttribute('src',url);
				LoadNum ++;
				if(LoadNum === len){
					JRight.init(true);//图片完全载入后重载样式
				};
			}).error(function(){
				len -= 1;
			});
		})(i);
	};
};

/*
	容器添加事件监听，阻止默认事件
	主要是针对有链接的大图片，如果图片存在链接
	拖拽会造成跳转
*/
Common.getId('postWrap').addEventListener('click',function(e){
	var e = e || window.event;
	if(e.target.tagName === 'IMG'){
		if(e && e.preventDefault){
		　　e.preventDefault();
		}else{
		　　e.returnValue=false;
		}
	};
},false);
</script>
</body>
</html>